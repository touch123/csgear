# csgear
## loganly 日志分析插件

## 模块
1. 配置文件
  配置文件应有：日志文件目录、日志文件类型、日志关键信息提取规则、处理中间文件的存放目录、数据库的目录、处理结果文件的目录、日志过滤规则、以及其他程序功能配置。

1. 日志文件检测器 sensor

功能：
   根据配置文件中的日志目录，检测系统中存在的日志文件，登记到数据库中，状态设为未处理

输入：
  日志目录

输出：
  数据库

1. 日志采集器 spider

功能:
  按进程号拆分日志文件，提取关键信息

输入：
  日期：如有参，执行指定日期的处理，原先处理过的，也先删除数据库中的记录，重新处理
        如无参, 从日志文件登记表中取未处理的日志，进行处理，并登记
  日志类型： 
       postran, mis_clt, qrcodetran， qr_clt  等
输出：
  拆分出的进程文件写入配置文件指定的目录， 写入配置文件中指定的数据库文件。
  运行时间比较长，则同时也要输出执行过程、执行结果


1. 日志查询器 finder      
 
 功能：
   1. 根据数据库有的关键字段，到数据库检索指定数据，返回json格式的结果信息，包含结果文件路径，关键信息
   关键信息：RRN, date, amount, termid, countno, orderid
   2. 根据输入数据，到拆分出得文件中查找包含该数据的文件名称，要求：并发或多线程同时处理多个文件。

 输入：
  查询字符串， 以空格分隔多个条件参数。可以根据文本自动识别每个条件参数，
  如 123.10 识别为 金额， 12位数字字符串识别为 参考号， 6位数字字符串识别为 流水号 等等。
  识别后转为json 格式的参数字符串
 
 输出：
   josn格式的文件名列表

   
1. 过滤器  filter
功能： 
   根据设定的规则，过滤掉无用杂乱的信息，
   也可根据设定的规则替换原有的信息，达到转译日志文件为可读性好的文本   
   
输入：
   日期、日志类型、进程号、（配置文件中的规则）

输出：
   例：XX卡在XX终端 消费 XX 元，参考号为XX，订单号为XXX
   
1. 作为csgear的插件运行。   

## TODO

~~1. 拆分 ~~
1. 采集
1. 入库
1. docker 运行环境
1. django 前端

## 事件/计划
* 2019/07/18 部署docker 运行
* 2019/07/17 采集内容入sqlite, 插件并入csgear平台
* 2019/07/16  yaml配置文件，iso8583解包
* 2019/07/15  拆分文件，优化，提交代码库
